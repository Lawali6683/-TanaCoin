<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TanaCoin Wallet</title>
    <link rel="stylesheet" href="style.css">
    <style>
        Body{
            background: #eaffff97;
        }
        #{
    font-family: Arial, sans-serif;
    background-color: #eaffff97;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    text-shadow: 3px 4px 8px rgba(0, 0, 0, 0.3); 
    Text-align:center;
    overflow: auto;     
}

.wallet-container {
    background-color: #eaffff97;
    justify-content: center;
    
    padding: 0px;
    border-radius: 10px;
    text-align: center;
     border-top: 5px solid green;
    
    width: 100%;
    overflow: auto;     
}

.balance-container {
    margin-top: 20px;
    
   background: #66ff2b; 
    Border-radius:10px;
    border-top: 7px solid red;
    
    font-size: 20px;
}

.menu-container {
    margin-top: 20px;
    display: flex;
            justify-content: space-between;
            margin-top: 20px;
       box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);    
}



.hidden {
    display: none;
}

form label {
    display: block;
    margin: 10px 0 5px;
}

form input {
    width: 80%;
    padding: 10px;
    margin-bottom: 10px;
    Border-radius:10px;
    
}

.menu-container{
    margin-top: 2px;
    margin-top: 2px;
    display: flex;
            justify-content: space-between;
            margin-top: 2px;

}

button{
    background-color: #3498db;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.70);
}

 .balance-container {
            margin-top: 20px;
            font-size: 18px;
       border-bottom: 3px solid blue; 
          box-shadow: 0 4px 10px rgba(20, 0, 0, 0.75);
        }

        .balance-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #e9e9e9;
         box-shadow: 0 4px 10px rgba(0, 0, 0, 0.89);  
         border-bottom: 3px solid blue;     
            padding: 10px;
            border-radius: 8px;
        
        }

        .balance-display img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
       box-shadow: 0 4px 10px rgba(0, 0, 0, 0.70);    
        }

        .balance-display .tnc-amount {
            color: green;
            Font-weight: bold;
            Font-size: 17px;
        }

        .balance-display .dollar-amount {
            color: red;
            Font-weight: bold;
            Font-size: 17px;
        }
        
         .menu-item {
            text-align: center;
            
        }

        .menu-item img {
            width: 50px;
            height: 50px;
            Border-radius: 50%;
            
            display: block;
            margin: 0 auto 5px;
            
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.70);
        }

        .menu-item button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.70);
        }
       .menu-item:hover {
         background: #1100ff; 
         Border-radius: 10px;
       }
         .menu-item button:hover{
         background: #1100ff; 
         Border-radius: 10px;  
         } 
        .dollar{
            Font-weight: bold;
            Font-size: 30px;
        } 
         .container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    background-color: #ffaaf46c;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

h1 {
    text-align: center;
    color: #0066cc;
    font-size: 13px;
    margin-bottom: 20px;
    font-weight: bold;
}

.description {
    font-size: 10px;
    color: #555;
    font-weight: bold;
}

.highlight {
    color: #ff8800;
    font-weight: bold;
}
.pay{
    Color:#0018ff;
    Font-weight: bold;
    Font-size: 20px;
    
}
P{
    Font-weight: bold;
    
}

    </style>
</head>
<body>
    <i id="TanaCoinPrice" style="display: none;">$5.00</i>

    <div class="wallet-container">
                       <h2><i style="color:red;">üïäÔ∏èTana</i><i style="color:green;">Coin</i> Wallet</h2>        <span class="pay"     id="firstNameDispay lastNameDispay"></span>
                            
        <!-- Display user balance -->
        <div class="balance-container">
            <h3>Your Balance</h3>
            <p class ="dollar" id="dollar_total">$0.00</p>
            
        </div>
        
       <p> <section>
            <div class="balance-display">
                <img src="dove.png" alt="TanaCoin">
                <div>
                    <span class="tnc-amount" id="userBalance">TNC 0.00000</span>
                    <span class="dollar-amount" id="dollar_totalone">$0.00</span>
                </div>
            </div>            
        </section></p>

        <!-- Send/Receive Menu -->
       <p> <section>
                    
        <div class="menu-container">
            <div class="menu-item">
         <img src="send.png" alt="Send Icon">   
            <button id="sendBtn">Sending</button></div>
            <div>
              <div class="menu-item">
         <img src="receive.png" alt="Send Icon">  
            <button id="receiveBtn">Receiving</button>
        </div>
        </section></p>

        <!-- Send TanaCoin Form -->
        <div id="sendContainer" class="hidden">
            <h3>Send <i style="color:red;">üïäÔ∏èTana</i><i style="color:green;">Coin</i></h3>
            <p>Ally TNC <i style="color:red;">üïäÔ∏èTana</i><i style="color:green;">Coin</i> Wellet address you can send This Coin</p>
            <form id="sendForm">
                <label for="walletAddress">TNC Wallet Address:</label>
                <input type="text" id="walletAddress" required>
                
                <label for="amount">TNC Amount:</label>
                <input type="number" id="amount" required>
                
                <label for="password">Your Log in Password:</label>
                <input type="password" id="password" required>
                
                <button type="submit">Submit</button>
            </form>
        </div>

        <!-- Receive Wallet Address -->
        <div id="receiveContainer" class="hidden">
            <h3>Copy Your Wallet Address</h3>
            <p id="walletAddressDisplay"></p>
            <button id="copyBtn">Copy Wallet Address</button>
            <p style="color: blue;" id="copyMessage"></p>
        </div>

        <!-- Transaction History -->
       <section>
           <p>
        <div class="menu-container">
    <div class="menu-item">
        <img src="history1.png" alt="History Receive Icon">
        <button id="historyReceiveBtn">History Receive</button>
    </div>
    
    <div class="menu-item">
        <img src="history2.png" alt="History Send Icon">
        <button id="historySendBtn">History Sending</button>
    </div>
</div>
</section></p>
    

        <!-- History Containers -->
        <div id="historyReceiveContainer" class="hidden">
            <h3>Received TanaCoin History</h3>
            <div id="receivedHistoryList"></div>
        </div>

        <div id="historySendContainer" class="hidden">
            <h3>Sent TanaCoin History</h3>
            <div id="sentHistoryList"></div> 
        </div>
         <div class="container">
        <h1> <i style="color:red;">üïäÔ∏èTana</i><i style="color:green;">Coin</i> (TNC) Information</h1>
        <p class="description">
            target price for<span class="highlight">TanaCoin (TNC) </span> is $5, but it can go higher or lower depending on market conditions. As more people mine and use TNC coins, its value is expected to rise significantly, much like <span class="highlight">Bitcoin</span>. 
            y inviting others to join the TNC mining community, you can help grow the network and increase the potential earnings for everyone involved.

Take advantage of this opportunity‚Äîmine TNC coins today and watch your earnings grow with the network!!
        </p>   
            <img src="pm.png" style="width: 100%; height: 50%;">
    </div>
    </div>
<script>
    // Samun maballin da akwatinan da suka dace
const sendBtn = document.getElementById('sendBtn');
const receiveBtn = document.getElementById('receiveBtn');
const historyReceiveBtn = document.getElementById('historyReceiveBtn');
const historySendBtn = document.getElementById('historySendBtn');

const sendContainer = document.getElementById('sendContainer');
const receiveContainer = document.getElementById('receiveContainer');
const historyReceiveContainer = document.getElementById('historyReceiveContainer');
const historySendContainer = document.getElementById('historySendContainer');
const receivedHistoryList = document.getElementById('receivedHistoryList');
const sentHistoryList = document.getElementById('sentHistoryList');

// Aikin boye dukkan akwatinan
function hideAllContainers() {
    sendContainer.classList.add('hidden');
    receiveContainer.classList.add('hidden');
    historyReceiveContainer.classList.add('hidden');
    historySendContainer.classList.add('hidden');
}

function checkTransactionHistory() {
    if (!receivedHistoryList.innerHTML.trim()) {
        receivedHistoryList.innerHTML = '<p style="color:red;">Not Transactions History</p>';
    }
    if (!sentHistoryList.innerHTML.trim()) {
        sentHistoryList.innerHTML = '<p style="color:red;">Not Transactions History</p>';
    }
}

sendBtn.addEventListener('click', () => {
    if (sendContainer.classList.contains('hidden')) {
        hideAllContainers();
        sendContainer.classList.remove('hidden');
    } else {
        sendContainer.classList.add('hidden');
    }
});

receiveBtn.addEventListener('click', () => {
    if (receiveContainer.classList.contains('hidden')) {
        hideAllContainers();
        receiveContainer.classList.remove('hidden');
    } else {
        receiveContainer.classList.add('hidden');
    }
});

historyReceiveBtn.addEventListener('click', () => {
    if (historyReceiveContainer.classList.contains('hidden')) {
        hideAllContainers();
        historyReceiveContainer.classList.remove('hidden');
        checkTransactionHistory();
    } else {
        historyReceiveContainer.classList.add('hidden');
    }
});

historySendBtn.addEventListener('click', () => {
    if (historySendContainer.classList.contains('hidden')) {
        hideAllContainers();
        historySendContainer.classList.remove('hidden');
        checkTransactionHistory();
    } else {
        historySendContainer.classList.add('hidden');
    }
});
</script>
    <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, get, set, update } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    // Firebase Config
    const firebaseConfig = {
        apiKey: "AIzaSyBZl5lT_PEvGZh034gstErFfjEaMFsFzKY",
        authDomain: "tanacoin-mine.firebaseapp.com",
        databaseURL: "https://tanacoin-mine-default-rtdb.firebaseio.com/",
        projectId: "tanacoin-mine",
        storageBucket: "tanacoin-mine.appspot.com",
        messagingSenderId: "550307127686",
        appId: "1:550307127686:web:a7fb30e74aefebf3280c07",
        measurementId: "G-596X16VEGX"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth();
        
// DOM Elements for displaying names
const firstNameDisplay = document.getElementById('firstNameDispay');
const lastNameDisplay = document.getElementById('lastNameDispay');

function loadUserInfo() {
     localStorage
    const firstName = localStorage.getItem('firstName');
    const lastName = localStorage.getItem('lastName');

    if (firstName && lastName) {       
        firstNameDisplay.innerText = firstName;
        lastNameDisplay.innerText = lastName;
    } else {
       
        localStorage
        const userRef = firebase.database().ref('users/uid'); 
        userRef.once('value')
            .then(snapshot => {
                const userData = snapshot.val();
                if (userData) {
                    // Store in localStorage for future
                    localStorage.setItem('firstName', userData.firstName);
                    localStorage.setItem('lastName', userData.lastName);
                    // Display on page
                    firstNameDisplay.innerText = userData.firstName;
                    lastNameDisplay.innerText = userData.lastName;
                } else {
                    firstNameDisplay.innerText = "Unknown";
                    lastNameDisplay.innerText = "User";
                }
            })
            .catch(error => {
                console.error("Error fetching data:", error);
                firstNameDisplay.innerText = "Unknown";
                lastNameDisplay.innerText = "User";
            });
    }
}

document.addEventListener('DOMContentLoaded', loadUserInfo);


    // Fetch user data and update balance
    async function getUserData(uid) {
        let walletAddress = localStorage.getItem('walletAddress');
        let userBalance = parseFloat(localStorage.getItem('userBalance')) || 0;

        const pricePerTNC = parseFloat(document.getElementById('TanaCoinPrice').textContent) || 5.00;
        const dollarTotal = (userBalance * pricePerTNC).toFixed(2);

        document.getElementById('userBalance').textContent = `${userBalance.toFixed(5)} TNC`;
        document.getElementById('dollar_total').textContent = `$${dollarTotal}`;
        document.getElementById('dollar_totalone').textContent = `$${dollarTotal}`;

        if (!walletAddress) {
            const userRef = ref(db, `users/${uid}`);
            const userSnap = await get(userRef);
            if (userSnap.exists()) {
                const userData = userSnap.val();
                walletAddress = userData.walletAddress;
                userBalance = userData.userBalance;

                localStorage.setItem('walletAddress', walletAddress);
                localStorage.setItem('userBalance', userBalance);
            }
        }

        document.getElementById('walletAddressDisplay').textContent = walletAddress;
        document.getElementById('userBalance').textContent = `${userBalance} TNC`;
    }

    // Fetch recipient's name using wallet address
    async function getRecipientName(walletAddress) {
        const recipientRef = ref(db, `users/${walletAddress}`);
        const recipientSnap = await get(recipientRef);
        if (recipientSnap.exists()) {
            const recipientData = recipientSnap.val();
            return `${recipientData.firstName} ${recipientData.lastName}`;
        } else {
            throw new Error("Recipient not found!");
        }
    }

    // Send TanaCoin
    document.getElementById('sendForm').addEventListener('submit', async function (e) {
        e.preventDefault();

        const walletAddress = document.getElementById('walletAddress').value;
        const amount = parseInt(document.getElementById('amount').value);
        const password = document.getElementById('password').value;

        const user = auth.currentUser;
        if (!user) {
            alert("User not logged in!");
            return;
        }

        const senderRef = ref(db, `users/${user.uid}`);
        const senderSnap = await get(senderRef);
        if (senderSnap.exists()) {
            const senderData = senderSnap.val();

            if (password !== senderData.password) {
                alert('Password is incorrect!');
                return;
            }

            if (senderData.userBalance < amount) {
                alert('Insufficient Balance!');
                return;
            }

            try {
                const recipientName = await getRecipientName(walletAddress);
                const confirmation = confirm(`Are you sure to send ${amount} TNC to ${recipientName} (${walletAddress})?`);
                if (!confirmation) return;

                // Update sender's balance
                const newBalance = senderData.userBalance - amount;
                await update(senderRef, { userBalance: newBalance });
                localStorage.setItem('userBalance', newBalance);

                // Update recipient's balance
                const recipientRef = ref(db, `users/${walletAddress}`);
                const recipientSnap = await get(recipientRef);
                if (recipientSnap.exists()) {
                    const recipientData = recipientSnap.val();
                    const recipientNewBalance = (recipientData.userBalance || 0) + amount;
                    await update(recipientRef, { userBalance: recipientNewBalance });
                }

                // Save transaction to history
                const transactionId = `txn_${Date.now()}`;
                const transactionRef = ref(db, `transactions/${transactionId}`);
                await set(transactionRef, {
                    sender: user.uid,
                    recipient: walletAddress,
                    amount,
                    timestamp: new Date().toISOString(),
                    recipientName
                });

                alert(`TanaCoin sending successful to ${recipientName}! New Balance: ${newBalance} TNC`);
                getUserData(user.uid);
            } catch (error) {
                alert(`Error: ${error.message}`);
            }
        }
    });

    // Copy wallet address
    document.getElementById('copyBtn').addEventListener('click', () => {
        const walletAddress = document.getElementById('walletAddressDisplay').textContent;
        navigator.clipboard.writeText(walletAddress).then(() => {
            document.getElementById('copyMessage').textContent = "Copy Your Wallet Address successfully!";
        });
    });

    // Initialize user data when user is logged in
    onAuthStateChanged(auth, (user) => {
        if (user) {
            getUserData(user.uid);
        } else {
            alert("No user logged in. Please log in first.");
        }
    });
</script>
</body>
</html>

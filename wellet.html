<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TanaCoin Wallet</title>
    <link rel="stylesheet" href="style.css">
    <style>
        Body{
            background: #eaffff97;
            Text-align: center;
        }
        #{
    font-family: Arial, sans-serif;
    background-color: #eaffff97;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    text-shadow: 3px 4px 8px rgba(0, 0, 0, 0.3); 
    Text-align:center;
    overflow: auto;     
}

.wallet-container {
    background-color: #eaffff97;
    justify-content: center;
    
    padding: 1px;
    border-radius: 10px;
    text-align: center;
     border-top: 5px solid green;
    
    width: 100%;
    overflow: auto;     
}

.balance-container {
    margin-top: 20px;
    
   background: #66ff2b; 
    Border-radius:10px;
    border-top: 7px solid red;
    
    font-size: 20px;
}

.menu-container {
    margin-top: 20px;
    display: flex;
            justify-content: space-between;
            margin-top: 20px;
       box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);    
}



.hidden {
    display: none;
}

form label {
    display: block;
    margin: 10px 0 5px;
}

form input {
    width: 80%;
    padding: 10px;
    margin-bottom: 10px;
    Border-radius:10px;
    
}

.menu-container{
    margin-top: 2px;
    margin-top: 2px;
    display: flex;
            justify-content: space-between;
            margin-top: 2px;

}

button{
    background-color: #3498db;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.70);
}
button hover{
    Background: blue;
}


 .balance-container {
            margin-top: 20px;
            font-size: 18px;
       border-bottom: 3px solid blue; 
          box-shadow: 0 4px 10px rgba(20, 0, 0, 0.75);
        }

        .balance-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #e9e9e9;
         box-shadow: 0 4px 10px rgba(0, 0, 0, 0.89);  
         border-bottom: 3px solid blue;     
            padding: 10px;
            border-radius: 8px;
        
        }

        .balance-display img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
       box-shadow: 0 4px 10px rgba(0, 0, 0, 0.70);    
        }

        .balance-display .tnc-amount {
            color: green;
            Font-weight: bold;
            Font-size: 17px;
        }

        .balance-display .dollar-amount {
            color: red;
            Font-weight: bold;
            Font-size: 17px;
        }
        
         .menu-item {
            text-align: center;
            
        }

        .menu-item img {
            width: 50px;
            height: 50px;
            Border-radius: 50%;
            
            display: block;
            margin: 0 auto 5px;
            
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.70);
        }

        .menu-item button {
     
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.70);
        }
       .menu-item:hover {
         background: #1100ff; 
         Border-radius: 10px;
       }
         .menu-item button:hover{
         background: #1100ff; 
         Border-radius: 10px;  
         } 
        .dollar{
            Font-weight: bold;
            Font-size: 30px;
        } 
         .container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    background-color: #ffaaf46c;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

h1 {
    text-align: center;
    color: #0066cc;
    font-size: 13px;
    margin-bottom: 20px;
    font-weight: bold;
}

.description {
    font-size: 10px;
    color: #555;
    font-weight: bold;
}

.highlight {
    color: #ff8800;
    font-weight: bold;
}
.pay{
    font-size: 20px;
            color: #27ae60;
            text-transform: capitalize;
            border: 2px dashed #2ecc71;
            padding: 5px;
            Font-weight: bold;
            Text-align: center;
            border-radius: 10px;
        }
P{
    Font-weight: bold;
    
}

.amount-container {
    display: flex;
    align-items: center;
}

#amount {
    width: 100px;
    padding: 10px;
    margin-right: 10px;
    border-radius: 10px;
    border: 2px solid #333;
}

#coinEquivalent {
    font-size: 19px;
    font-weight: bold;
    color: #4A90E2;
}
#walletAddressDisplay{
    Font-weight:  bold;
    Font-size: 11px;
}
.TNC{
    Font-weight: bold;
    Font-size: 20px;
    Color: red;
}
.pay{ 

    background: repeating-linear-gradient(
                -45deg,
                #3498db,
                #3498db 10px,
                #2980b9 10px,
                #2980b9 20px
            );
            color: white;
            padding: 10px;
            border-radius: 10px;
     
}

#walletAddressDisplay{
    Font-weight: bold;
    Font-size: 9px;
}
#receivedHistoryList{
    Font-weight: bold;
    Font-size: 10px;
}
#sentHistoryList{
    Font-weight: bold;
    Font-size: 10px;
}
    </style>
</head>
<body>
    <i id="TanaCoinPrice" style="display: none;">$5.00</i>

    <div class="wallet-container">
                       <h2 class="pay"><i style="color:red;">üïäÔ∏èTana</i><i style="color:green;">Coin</i> Wallet        <span id="firstNameDisplay"></span> <span id="lastNameDisplay"></span></h2>

                            
        <!-- Display user balance -->
        <div class="balance-container">
            <h3>Your Balance</h3>
            <p class ="dollar" id="dollar_total">$0.00</p>
            
        </div>
        
       <p> <section>
            <div class="balance-display">
                <img src="dove.png" alt="TanaCoin">
                <div>
                    <span class="TNC">TN<i style="color:green;">C</i></span> <span class="tnc-amount" id="userBalance"> 0.00000</span>
                    <span class="dollar-amount" id="dollar_totalone">$0.00</span>
                </div>
            </div>            
        </section></p>

        <!-- Send/Receive Menu -->
       <p> <section>
           <p><button onclick="location.href='chenge.html'">Chenge TNC & withdraw</button>
</p>      
        <div class="menu-container">
            
            <div class="menu-item">
         <img src="send.png" alt="Send Icon">   
            <button id="sendBtn">Sending</button></div>
            <div>
              <div class="menu-item">
         <img src="receive.png" alt="Send Icon">  
            <button id="receiveBtn">Receiving</button>
        </div>
        </section></p>

        <!-- Send TanaCoin Form -->
        <div id="sendContainer" class="hidden">
    <h3>Send <i style="color:red;">üïäÔ∏èTana</i><i style="color:green;">Coin</i></h3>
    <p>Ally TNC <i style="color:red;">üïäÔ∏èTana</i><i style="color:green;">Coin</i> Wallet address you can send this Coin</p>
    <form id="sendForm">
        <label for="walletAddress">TNC Wallet Address:</label>
        <input type="text" id="walletAddress" placeholder="Ally TanaCoin Wallet Address" required>

        <label for="amount">TNC Amount (in dollars):</label>
        <div class="amount-container">
            <input type="" id="amount" placeholder="$0.00" required>
            <span id="coinEquivalent">TNC: 0.00000</span>
        </div>

        <label for="password">Your Login Password:</label>
        <input type="password" id="password" placeholder="Your password" required>

        <button type="submit">Submit</button>
    </form>
</div>

        <!-- Receive Wallet Address -->
        <div id="receiveContainer" class="hidden">
            <h3>Copy Your Wallet Address</h3>
            <p id="walletAddressDisplay"></p>
            <button id="copyBtn">Copy Wallet Address</button>
            <p style="color: blue;" id="copyMessage"></p>
        </div>

        <!-- Transaction History -->
       <section>
           <p>
        <div class="menu-container">
    <div class="menu-item">
        <img src="history1.png" alt="History Receive Icon">
        <button id="historyReceiveBtn">History Receive</button>
    </div>
    
    <div class="menu-item">
        <img src="history2.png" alt="History Send Icon">
        <button id="historySendBtn">History Sending</button>
    </div>
</div>
</section></p>
    

        <!-- History Containers -->
        <div id="historyReceiveContainer" class="hidden">
            <h3>Received <i style="color:red;">üïäÔ∏èTana</i><i style="color:green;">Coin</i> History</h3>
            <div id="receivedHistoryList"></div>
        </div>

        <div id="historySendContainer" class="hidden">
            <h3>Send <i style="color:red;">üïäÔ∏èTana</i><i style="color:green;">Coin</i> History</h3>
            <div id="sentHistoryList"></div> 
        </div>
         <div class="container">
        <h1> <i style="color:red;">üïäÔ∏èTana</i><i style="color:green;">Coin</i> (TNC) Information</h1>
        <p class="description">
            target price for<span class="highlight">TanaCoin (TNC) </span> is $5, but it can go higher or lower depending on market conditions. As more people mine and use TNC coins, its value is expected to rise significantly, much like <span class="highlight">Bitcoin</span>. 
            y inviting others to join the TNC mining community, you can help grow the network and increase the potential earnings for everyone involved.

Take advantage of this opportunity‚Äîmine TNC coins today and watch your earnings grow with the network!!
        </p>   
            <img src="pm.png" style="width: 100%; height: 50%;">
    </div>
    </div>
    <script>
    // Samun maballin da akwatinan da suka dace
const sendBtn = document.getElementById('sendBtn');
const receiveBtn = document.getElementById('receiveBtn');
const historyReceiveBtn = document.getElementById('historyReceiveBtn');
const historySendBtn = document.getElementById('historySendBtn');

const sendContainer = document.getElementById('sendContainer');
const receiveContainer = document.getElementById('receiveContainer');
const historyReceiveContainer = document.getElementById('historyReceiveContainer');
const historySendContainer = document.getElementById('historySendContainer');
const receivedHistoryList = document.getElementById('receivedHistoryList');
const sentHistoryList = document.getElementById('sentHistoryList');

// Aikin boye dukkan akwatinan
function hideAllContainers() {
    sendContainer.classList.add('hidden');
    receiveContainer.classList.add('hidden');
    historyReceiveContainer.classList.add('hidden');
    historySendContainer.classList.add('hidden');
}

// Duba shafin "Send"
sendBtn.addEventListener('click', () => {
    if (sendContainer.classList.contains('hidden')) {
        hideAllContainers();
        sendContainer.classList.remove('hidden');
    } else {
        sendContainer.classList.add('hidden');
    }
});

// Duba shafin "Receive"
receiveBtn.addEventListener('click', () => {
    if (receiveContainer.classList.contains('hidden')) {
        hideAllContainers();
        receiveContainer.classList.remove('hidden');
    } else {
        receiveContainer.classList.add('hidden');
    }
});

// Duba tarihin "Receive" (amma ba tare da kiran checkTransactionHistory ba, saboda an riga an loda tarihin)
historyReceiveBtn.addEventListener('click', () => {
    if (historyReceiveContainer.classList.contains('hidden')) {
        hideAllContainers();
        historyReceiveContainer.classList.remove('hidden');
    } else {  
        historyReceiveContainer.classList.add('hidden');
    }
});

// Duba tarihin "Send" (amma ba tare da kiran checkTransactionHistory ba, saboda an riga an loda tarihin)
historySendBtn.addEventListener('click', () => {
    if (historySendContainer.classList.contains('hidden')) {
        hideAllContainers();
        historySendContainer.classList.remove('hidden');
    } else {
        historySendContainer.classList.add('hidden');
    }
});
</script>
                
       <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, get, update, push } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    // Firebase Config
    const firebaseConfig = {
        apiKey: "AIzaSyBZl5lT_PEvGZh034gstErFfjEaMFsFzKY",
        authDomain: "tanacoin-mine.firebaseapp.com",
        databaseURL: "https://tanacoin-mine-default-rtdb.firebaseio.com/",
        projectId: "tanacoin-mine",
        storageBucket: "tanacoin-mine.appspot.com",
        messagingSenderId: "550307127686",
        appId: "1:550307127686:web:a7fb30e74aefebf3280c07",
        measurementId: "G-596X16VEGX"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth();

    // DOM Elements for displaying user info
    const firstNameDisplay = document.getElementById('firstNameDisplay');
    const lastNameDisplay = document.getElementById('lastNameDisplay');
    const userBalanceElement = document.getElementById('userBalance');
    const dollarTotalElement = document.getElementById('dollar_total');
    const dollarTotalOneElement = document.getElementById('dollar_totalone');
    const walletAddressDisplay = document.getElementById('walletAddressDisplay');
    const amountInput = document.getElementById('amount');
    const coinEquivalent = document.getElementById('coinEquivalent');
    const sendForm = document.getElementById('sendForm');
    const copyMessage = document.getElementById('copyMessage');
    const TanaCoinPrice = parseFloat(document.getElementById('TanaCoinPrice').textContent) || 5.00;

    // Load user information from Firebase
    function loadUserInfo(uid) {
        const userRef = ref(db, `users/${uid}`);
        get(userRef).then(snapshot => {
            const data = snapshot.val();
            if (data) {
                firstNameDisplay.textContent = data.firstName;
                lastNameDisplay.textContent = data.lastName;
                walletAddressDisplay.textContent = data.walletAddress || "Not Available";
            }
        }).catch(console.error);
    }

    // Fetch user data and update balance
    async function getUserData(uid) {
        const userRef = ref(db, `users/${uid}`);
        const userSnap = await get(userRef);
        if (userSnap.exists()) {
            const userData = userSnap.val();
            const userBalance = parseFloat(userData.userBalance) || 0;
            const dollarTotal = (userBalance * TanaCoinPrice).toFixed(2);

            userBalanceElement.textContent = `${userBalance.toFixed(5)} `;
            dollarTotalElement.textContent = `$${dollarTotal}`;
            dollarTotalOneElement.textContent = `$${dollarTotal}`;
        }
    }

    // Calculate TanaCoin equivalent from dollar input
    amountInput.addEventListener('input', function () {
        const amountInDollars = parseFloat(amountInput.value);
        const equivalentTNC = isNaN(amountInDollars) || amountInDollars <= 0 ? 0 : (amountInDollars / TanaCoinPrice).toFixed(5);
        coinEquivalent.textContent = `TNC: ${equivalentTNC}`;
    });

    // Handle Wallet Address Verification
    document.getElementById('walletAddress').addEventListener('blur', async function () {
        const walletAddress = document.getElementById('walletAddress').value.trim();
        if (!walletAddress) return;

        try {
            const usersRef = ref(db, `users`);
            const snapshot = await get(usersRef);
            if (snapshot.exists()) {
                const users = snapshot.val();
                let recipientFound = null;

                for (const userId in users) {
                    if (users[userId].walletAddress === walletAddress) {
                        recipientFound = users[userId];
                        break;
                    }
                }

                if (recipientFound) {
                    alert(`Recipient Found: ${recipientFound.firstName} ${recipientFound.lastName}`);
                } else {
                    alert("This Wallet address not found in TanaCoin Mine!");
                }
            } else {
                alert("No users in TanaCoin Miner!");
            }
        } catch (error) {
            console.error("Error fetching users:", error);
            alert("An error occurred while verifying wallet address.");
        }
    });

    // Handle TanaCoin Transfer
    sendForm.addEventListener('submit', async function (e) {
        e.preventDefault();

        const walletAddress = document.getElementById('walletAddress').value.trim();
        const amount = parseFloat(amountInput.value);
        const password = document.getElementById('password').value.trim();

        const user = auth.currentUser;
        if (!user) {
            alert("User not logged in!");
            return;
        }

        try {
            // Authenticate user
            await signInWithEmailAndPassword(auth, user.email, password);

            const senderRef = ref(db, `users/${user.uid}`);
            const senderSnap = await get(senderRef);
            if (!senderSnap.exists()) throw new Error("Sender data not found!");

            const senderData = senderSnap.val();
            const amountInTNC = amount / TanaCoinPrice;

            if (senderData.userBalance < amountInTNC) {
                alert("Insufficient balance!");
                return;
            }

            // Fetch recipient data
            const recipientRef = ref(db, `users`);
            const snapshot = await get(recipientRef);
            if (!snapshot.exists()) throw new Error("No users found in Miners!");

            let recipientData = null;
            let recipientKey = null;

            for (const userId in snapshot.val()) {
                const userData = snapshot.val()[userId];
                if (userData.walletAddress === walletAddress) {
                    recipientData = userData;
                    recipientKey = userId;
                    break;
                }
            }

            if (!recipientData) {
                alert("Recipient not found!");
                return;
            }

            const recipientName = `${recipientData.firstName} ${recipientData.lastName}`;
            const confirmSend = confirm(`Are you sure you want to send ${amountInTNC.toFixed(5)} TNC $${amount} to ${recipientName} (${walletAddress})?`);
            if (!confirmSend) return;

            // Update balances only after confirmation
            const newSenderBalance = senderData.userBalance - amountInTNC;
            const newRecipientBalance = (recipientData.userBalance || 0) + amountInTNC;

            // Perform transfer (transaction)
            await update(ref(db, `users/${recipientKey}`), { userBalance: newRecipientBalance });
            await update(senderRef, { userBalance: newSenderBalance });

            // Add to transaction history
            await addToSendHistory(user.uid, walletAddress, amountInTNC, recipientName);
            await addToReceivedHistory(walletAddress, user.uid, amountInTNC, senderData.firstName + ' ' + senderData.lastName);

            // Clear form after successful transaction
            sendForm.reset();
            // Update user balance on the dashboard
            getUserData(user.uid);

            alert("Transaction successful!");

        } catch (error) {
            console.error("Transaction error:", error);
            alert("Transaction failed! Error password Or Network issue Your TNC unchanged.");
        }
    });

    // Copy wallet address
    document.getElementById('copyBtn').addEventListener('click', () => {
        const walletAddress = walletAddressDisplay.textContent;
        navigator.clipboard.writeText(walletAddress).then(() => {
            copyMessage.textContent = "Copied your Wallet Address successfully!";
        });
    });

    // Transaction history
async function addToSendHistory(senderId, recipientAddress, amount, recipientName) {
    const sendHistoryRef = ref(db, `sendHistory/${senderId}`);
    await push(sendHistoryRef, {
        recipient: recipientAddress,
        amount,
        recipientName,
        timestamp: new Date().toISOString()
    });
}

async function addToReceivedHistory(recipientAddress, senderId, amount, senderName) {
    const receivedHistoryRef = ref(db, `receivedHistory/${recipientAddress}`);
    await push(receivedHistoryRef, {
        sender: senderId,
        amount,
        senderName,
        timestamp: new Date().toISOString()
    });
}

// Fetch and display send transaction history
async function getSendHistory(uid) {
    const sendHistoryRef = ref(db, `sendHistory/${uid}`);
    const snapshot = await get(sendHistoryRef);
    if (snapshot.exists()) {
        const history = snapshot.val();
        const sendHistoryList = document.getElementById('sentHistoryList');
        sendHistoryList.innerHTML = ""; // Clear existing history
        for (const key in history) {
            const { recipient, amount, recipientName, timestamp } = history[key];
            
            // Convert TNC amount to USD
            const amountInUSD = (amount * TanaCoinPrice).toFixed(2);
            const formattedTimestamp = new Date(timestamp).toLocaleString();

            // Display history item
            const historyItem = document.createElement('div');
            historyItem.innerHTML = `
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <span style="font-weight: bold; color: green;">‚úîÔ∏è</span>
                    <span style="margin-left: 8px;">You sending TNC ${amount} ($${amountInUSD}) to ${recipientName} on ${formattedTimestamp}</span>
                </div>
            `;
            sendHistoryList.appendChild(historyItem);
        }
    }
}

// Fetch and display receive transaction history
async function getReceivedHistory(walletAddress) {
    const receivedHistoryRef = ref(db, `receivedHistory/${walletAddress}`);
    const snapshot = await get(receivedHistoryRef);
    if (snapshot.exists()) {
        const history = snapshot.val();
        const receivedHistoryList = document.getElementById('receivedHistoryList');
        receivedHistoryList.innerHTML = ""; // Clear existing history
        for (const key in history) {
            const { sender, amount, senderName, timestamp } = history[key];
            
            // Convert TNC amount to USD
            const amountInUSD = (amount * TanaCoinPrice).toFixed(2);
            const formattedTimestamp = new Date(timestamp).toLocaleString();

            // Display history item
            const historyItem = document.createElement('div');
            historyItem.innerHTML = `
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <span style="font-weight: bold; color: blue;">‚úîÔ∏è</span>
                    <span style="margin-left: 8px;">You received TNC ${amount} ($${amountInUSD}) from ${senderName} on ${formattedTimestamp}</span>
                </div>
            `;
            receivedHistoryList.appendChild(historyItem);
        }
    }
}

    // Monitor auth state changes and load user data
    onAuthStateChanged(auth, (user) => {
        if (user) {
            loadUserInfo(user.uid);
            getSendHistory(user.uid);
            getReceivedHistory(user.uid);  // Ensure received history is also loaded
            getUserData(user.uid);  // Ensure balance and wallet info is up-to-date
        } else {
            alert("No user logged in. Please log in first.");
        }
    });
</script>
                                                        
</body>
</html>

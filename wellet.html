<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TanaCoin Wallet</title>
    <link rel="stylesheet" href="style.css">
    <style>
        #{
    font-family: Arial, sans-serif;
    background-color: #3b3134;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    text-shadow: 3px 4px 8px rgba(0, 0, 0, 0.3); 
    Text-align:center;
    overflow: auto;     
}

.wallet-container {
    background-color: node;
    justify-content: center;
    
    padding: 0px;
    border-radius: 10px;
    text-align: center;
     border-top: 5px solid green;
    
    width: 100%;
    overflow: auto;     
}

.balance-container {
    margin-top: 20px;
    
   background: #66ff2b; 
    Border-radius:10px;
    border-top: 7px solid red;
    
    font-size: 20px;
}

.menu-container {
    margin-top: 20px;
    display: flex;
            justify-content: space-between;
            margin-top: 20px;
       box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);    
}



.hidden {
    display: none;
}

form label {
    display: block;
    margin: 10px 0 5px;
}

form input {
    width: 100%;
    padding: 8px;
    margin-bottom: 10px;
}

.menu-container{
    margin-top: 2px;
    margin-top: 2px;
    display: flex;
            justify-content: space-between;
            margin-top: 2px;

}



 .balance-container {
            margin-top: 20px;
            font-size: 18px;
       border-bottom: 3px solid blue; 
          box-shadow: 0 4px 10px rgba(20, 0, 0, 0.75);
        }

        .balance-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #e9e9e9;
         box-shadow: 0 4px 10px rgba(0, 0, 0, 0.89);  
         border-bottom: 3px solid blue;     
            padding: 10px;
            border-radius: 8px;
        
        }

        .balance-display img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
       box-shadow: 0 4px 10px rgba(0, 0, 0, 0.70);    
        }

        .balance-display .tnc-amount {
            color: green;
            Font-weight: bold;
            Font-size: 12px;
        }

        .balance-display .dollar-amount {
            color: red;
            Font-weight: bold;
            Font-size: 12px;
        }
        
         .menu-item {
            text-align: center;
            
        }

        .menu-item img {
            width: 50px;
            height: 50px;
            Border-radius: 50%;
            
            display: block;
            margin: 0 auto 5px;
            
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.70);
        }

        .menu-item button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.70);
        }
       .menu-item:hover {
         background: #1100ff; 
         Border-radius: 10px;
       }
         .menu-item button:hover{
         background: #1100ff; 
         Border-radius: 10px;  
         } 
        .dollar{
            Font-weight: bold;
            Font-size: 30px;
        } 
         .container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

h1 {
    text-align: center;
    color: #0066cc;
    font-size: 13px;
    margin-bottom: 20px;
    font-weight: bold;
}

.description {
    font-size: 10px;
    color: #555;
    font-weight: bold;
}

.highlight {
    color: #ff8800;
    font-weight: bold;
}
    </style>
</head>
<body>
    <i id="TanaCoinPrice" style="display: none;">$5.00</i>

    <div class="wallet-container">
                       <h2><i style="color:red;">üïäÔ∏èTana</i><i style="color:green;">Coin</i> Wallet</h2>
        <h2 id="userName">
                            
        <!-- Display user balance -->
        <div class="balance-container">
            <h3>Your Balance</h3>
            <p class ="dollar" id="dollar_total">$0.00</p>
            
        </div>
        
       <p> <section>
            <div class="balance-display">
                <img src="dove.png" alt="TanaCoin">
                <div>
                    <span class="tnc-amount" id="userBalance">0.00000 TNC</span>
                    <span class="dollar-amount" id="dollar_totalone">$0.00</span>
                </div>
            </div>            
        </section></p>

        <!-- Send/Receive Menu -->
       <p> <section>
                    
        <div class="menu-container">
            <div class="menu-item">
         <img src="send.png" alt="Send Icon">   
            <button id="sendBtn">Sending</button></div>
            <div>
              <div class="menu-item">
         <img src="receive.png" alt="Send Icon">  
            <button id="receiveBtn">Receiving</button>
        </div>
        </section></p>

        <!-- Send TanaCoin Form -->
        <div id="sendContainer" class="hidden">
            <h3>Send <i style="color:red;">üïäÔ∏èTana</i><i style="color:green;">Coin</i></h3>
            <p>Ally <i style="color:red;">üïäÔ∏èTana</i><i style="color:green;">Coin</i> Wellet address you can send This Coin</p>
            <form id="sendForm">
                <label for="walletAddress">Wallet Address:</label>
                <input type="text" id="walletAddress" required>
                
                <label for="amount">Amount:</label>
                <input type="number" id="amount" required>
                
                <label for="password">Password:</label>
                <input type="password" id="password" required>
                
                <button type="submit">Submit</button>
            </form>
        </div>

        <!-- Receive Wallet Address -->
        <div id="receiveContainer" class="hidden">
            <h3>Your Wallet Address</h3>
            <p id="walletAddressDisplay"></p>
            <button id="copyBtn">Copy Wallet Address</button>
            <p id="copyMessage"></p>
        </div>

        <!-- Transaction History -->
       <section>
           <p>
        <div class="menu-container">
    <div class="menu-item">
        <img src="history1.png" alt="History Receive Icon">
        <button id="historyReceiveBtn">History Receive</button>
    </div>
    
    <div class="menu-item">
        <img src="history2.png" alt="History Send Icon">
        <button id="historySendBtn">History Sending</button>
    </div>
</div>
</section></p>
    

        <!-- History Containers -->
        <div id="historyReceiveContainer" class="hidden">
            <h3>Received TanaCoin History</h3>
            <div id="receivedHistoryList"></div>
        </div>

        <div id="historySendContainer" class="hidden">
            <h3>Sent TanaCoin History</h3>
            <div id="sentHistoryList"></div> 
        </div>
         <div class="container">
        <h1> <i style="color:red;">üïäÔ∏èTana</i><i style="color:green;">Coin</i> (TNC) Information</h1>
        <p class="description">
            target price for<span class="highlight">TanaCoin (TNC) </span> is $5, but it can go higher or lower depending on market conditions. As more people mine and use TNC coins, its value is expected to rise significantly, much like <span class="highlight">Bitcoin</span>. 
            y inviting others to join the TNC mining community, you can help grow the network and increase the potential earnings for everyone involved.

Take advantage of this opportunity‚Äîmine TNC coins today and watch your earnings grow with the network!!
        </p>   
            <img src="pm.png" style="width: 100%; height: 50%;">
    </div>
    </div>

    <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    // Firebase Config
    const firebaseConfig = {
        apiKey: "AIzaSyCldVBlGP7hsERLEa9R30PSYZEOXppYvDs",
        authDomain: "tanacoin-75344.firebaseapp.com",
        projectId: "tanacoin-75344",
        storageBucket: "tanacoin-75344.appspot.com",
        messagingSenderId: "425342256564",
        appId: "1:425342256564:web:b33f74f41e8d7d62659ee1"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth();

    // Fetch user data and update balance
    async function getUserData(uid) {
        let walletAddress = localStorage.getItem('walletAddress');
        let userBalance = parseFloat(localStorage.getItem('userBalance')) || 0;

        const pricePerTNC = parseFloat(document.getElementById('TanaCoinPrice').textContent) || 5.00;
        const dollarTotal = (userBalance * pricePerTNC).toFixed(2);

        document.getElementById('userBalance').textContent = `${userBalance.toFixed(5)} TNC`;
        document.getElementById('dollar_total').textContent = `$${dollarTotal}`;
        document.getElementById('dollar_totalone').textContent = `$${dollarTotal}`;

        if (!walletAddress) {
            const userDoc = await getDoc(doc(db, "users", uid));
            walletAddress = userDoc.data().walletAddress;
            userBalance = userDoc.data().userBalance;

            localStorage.setItem('walletAddress', walletAddress);
            localStorage.setItem('userBalance', userBalance);
        }

        document.getElementById('walletAddressDisplay').textContent = walletAddress;
        document.getElementById('userBalance').textContent = `${userBalance} TNC`;
    }

    // Fetch recipient's name using wallet address
    async function getRecipientName(walletAddress) {
        const recipientDoc = await getDoc(doc(db, "users", walletAddress));
        if (recipientDoc.exists()) {
            const recipientData = recipientDoc.data();
            return `${recipientData.firstName} ${recipientData.lastName}`;
        } else {
            throw new Error("Recipient not found!");
        }
    }

    // Send TanaCoin
    document.getElementById('sendForm').addEventListener('submit', async function (e) {
        e.preventDefault();

        const walletAddress = document.getElementById('walletAddress').value;
        const amount = parseInt(document.getElementById('amount').value);
        const password = document.getElementById('password').value;

        const user = auth.currentUser;
        if (!user) {
            alert("User not logged in!");
            return;
        }

        const senderDoc = await getDoc(doc(db, "users", user.uid));
        const senderData = senderDoc.data();

        if (password !== senderData.password) {
            alert('Password is incorrect!');
            return;
        }

        if (senderData.userBalance < amount) {
            alert('Insufficient Balance!');
            return;
        }

        try {
            const recipientName = await getRecipientName(walletAddress);
            const confirmation = confirm(`Are you sure to send ${amount} TNC to ${recipientName} (${walletAddress})?`);
            if (!confirmation) return;

            // Update sender's balance
            const newBalance = senderData.userBalance - amount;
            await updateDoc(doc(db, "users", user.uid), { userBalance: newBalance });
            localStorage.setItem('userBalance', newBalance);

            // Update recipient's balance
            const recipientDoc = await getDoc(doc(db, "users", walletAddress));
            const recipientData = recipientDoc.data();
            const recipientNewBalance = (recipientData.userBalance || 0) + amount;
            await updateDoc(doc(db, "users", walletAddress), { userBalance: recipientNewBalance });

            // Save transaction to history
            const transactionId = `txn_${Date.now()}`;
            await setDoc(doc(db, "transactions", transactionId), {
                sender: user.uid,
                recipient: walletAddress,
                amount,
                timestamp: new Date(),
                recipientName
            });

            alert(`TanaCoin sending successful to ${recipientName}! New Balance: ${newBalance} TNC`);
            getUserData(user.uid);
        } catch (error) {
            alert(`Error: ${error.message}`);
        }
    });

    // Copy wallet address
    document.getElementById('copyBtn').addEventListener('click', () => {
        const walletAddress = document.getElementById('walletAddressDisplay').textContent;
        navigator.clipboard.writeText(walletAddress).then(() => {
            document.getElementById('copyMessage').textContent = "Copied Wallet Address successfully!";
        });
    });

    // Initialize user data when user is logged in
    onAuthStateChanged(auth, (user) => {
        if (user) {
            getUserData(user.uid);
        } else {
            alert("No user logged in. Please log in first.");
        }
    });
</script>
</body>
</html>

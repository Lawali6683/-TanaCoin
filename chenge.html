<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coin Market</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #95fff597;
            margin: 0;
            padding: 0;
        }

        header {
            background-color: #007bff;
            color: white;
            padding: 1rem;
            text-align: center;
        }

        h1 {
            margin: 0;
        }

        main {
            margin: 20px;
        }

        .balance-section, .market-section, .wallet-section {
            margin: 20px 0;
        }

        button {
    padding: 10px 15px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

button:hover {
    background-color: #0056b3;
}
       #withdrawal-form, .hidden-form {
            display: none;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .market-option {
            text-align: center;
            margin-bottom: 20px;
        }

    .market-section  input {
    width: 110px;
            padding: 10px;
            border: 1px solid #90ff2b;
            border-radius: 10px;
        }

        .hidden {
            display: none;
        }
        
    </style>
    <style>

 .market-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        .market-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 0; 
        }

        .market-img {
            width: 100px; 
            margin-bottom: 0;
            Border-radius:10px;
        }

        .market-option p, .market-option button {
            margin: 0; 
        }
        
input{
           padding: 18px;
            margin-bottom: 20px;
            border: 1px solid #90ff2b;
            border-radius: 10px;
            font-size: 10px;
            Font-weight:bold;
       }
    .wel{
        
      font-size: 20px;
      color: ##ff2b74;
      text-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff, 0 0 30px #00ffff;
        text-align: center;
        Color:#70ff40;
      }
     .container{
      width: 80%;
            max-width: 600px;
                        
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
            position: relative;
            Text-align:center;
            Font-weight:bold;
            Font-size:30px;
        }
         .notice-container {
      width: 100%;
      border-radius: 10px;
      padding: px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      max-width: 500px;
      width: 100%;
      text-align: center;
    }
    .notice-container h2 {
      color: #ff5e5e;
      margin-bottom: 10px;
      font-size: 24px;
    }
    .notice-container p {
      color: #333;
      font-size: 16px;
      line-height: 1.6;
    }
    .notice-container strong {
      color: #ff5e5e;
    }
    
    /* Sanya duhu a shafin baki daya */
.overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    z-index: 9999;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 25px;
    text-align: center;
}

/* Daga style na sakon TanaCoin */
.gutt{
    font-size: 25px;
    color: #fff;
    text-shadow: 0 0 1px #0f0, 0 0 20px #0f0, 0 0 30px #0f0, 0 0 40px #0f0;
}
.gut{
    font-size: 25px;
    color: #ff3;
    text-shadow: 3px 3px 0 #e60000, 6px 6px 0 #ffb3b3;
}
.Fut{
    font-size: 25px;
    background: linear-gradient(to right, #8e44ad, #3498db);
    -webkit-background-clip: text;
    color: transparent;
}

</style>
<style>

 .market-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        .market-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 0; 
        }

        .market-img {
            width: 100px; 
            margin-bottom: 0;
            Border-radius:10px;
        }

        .market-option p, .market-option button {
            margin: 0; 
        }
        
input{
           padding: 18px;
            margin-bottom: 20px;
            border: 1px solid #90ff2b;
            border-radius: 5px;
            font-size: 10px;
            Font-weight:bold;
       }
    .wel{
        
      font-size: 20px;
      color: ##ff2b74;
      text-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff, 0 0 30px #00ffff;
        text-align: center;
        Color:#70ff40;
      }
     .container{
      width: 80%;
            max-width: 600px;
            background-image:url("by.png");
            
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
            position: relative;
            Text-align:center;
            Font-weight:bold;
            Font-size:30px;
        }
    </style>
</head>
<body>
    <header>
        <h1 id="welcome-text">Welcome To Sell your <i style="color:red;">üïäÔ∏èTana</i><i style="color:green;">Coin</i> <span id="username">Username</span></h1>
    </header>

    <main>
        <section class="balance-section">
            <p>Your Total <i style="color:red;">üïäÔ∏èTana</i><i style="color:green;">Coin</i>: 
                <span id="userBalanceDisplay">0.00000</span>
            </p>
            <p>Market <i style="color:red;">üïäÔ∏èTana</i><i style="color:green;">Coin</i> Price: 
                $<span id="market-price">5.00000</span> per <i style="color:red;">üïäÔ∏èTana</i><i style="color:green;">Coin</i>
            </p>
        </section>

        <section class="market-section">
            <div class="market-option">
                <img src="b.png" alt="Binance" class="market-img">
                <p>5.905% fee</p>
                <button id="binanceBtn">Sell on Binance</button>
                <div id="binanceForm" class="hidden-form">
                    <input type="number" id="binanceAmount" placeholder="TNC Amount">
                    <input type="password" id="binancePassword" placeholder="Password">
                    <button id="submitBinance">Submit</button>
                </div>
            </div>
            <div class="market-option">
                <img src="c.png" alt="Coinbase" class="market-img">
                <p>6.2979% fee</p>
                <button id="coinbaseBtn">Sell on Coinbase</button>
                <div id="coinbaseForm" class="hidden-form">
                    <input type="number" id="coinbaseAmount" placeholder="TNC Amount">
                    <input type="password" id="coinbasePassword" placeholder="Password">
                    <button id="submitCoinbase">Submit</button>
                </div>
            </div>
        </section>

        <section <section class="wallet-section">
            <h2 class="wel"><center>Your Dollars TRC20 WELLET</center></h2>
  <center class="container">        <p>Balance: $<span id="usdBalance">0.00</span></p></center> 
     
         <div class="overlay">
    <div>
        <h2 class="gutt"><i style="color:red;">üïäÔ∏èTana</i><i style="color:green;">Coin</i> Chenge Market is Closed</h2>
        <p class="gut">Chenge <i style="color:red;">üïäÔ∏èTana</i><i style="color:green;">Coin</i> will reopen automatically when the Aidrop Mine Ends.</p>
        <h3 class="Fut"><i style="color:red;">üïäÔ∏èTana</i><i style="color:green;">Coin</i> Mining Time Court: <span id="endTime"></span></h3>
    </div>
</div>
  
  <div class="notice-container">
    <h2>Notice</h2>
    <p>
      Before you click <strong>submit</strong>, please ensure you have entered your 
      <strong>TRC20 wallet address</strong>. You can use a TRC20 wallet from Telegram or any other wallet, 
      but it must be a TRC20 wallet address only. You will lose your funds if you enter a 
      different address that is not TRC20.
    </p>
  </div> 
            <button id="withdrawBtn">Withdrawal</button>

            <div id="withdrawal-form">
                <input type="number" id="withdrawalAmount" placeholder="Amount $" required>
                <input type="text" id="telegramWallet" placeholder="Telegram Wallet Address" required>
                <input type="password" id="withdrawalPassword" placeholder="Password" required>
                <button id="submitWithdrawal">Submit</button>
            </div>
        </section>
    </main>
    

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getDatabase, ref, get, update } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyBZl5lT_PEvGZh034gstErFfjEaMFsFzKY",
            authDomain: "tanacoin-mine.firebaseapp.com",
            databaseURL: "https://tanacoin-mine-default-rtdb.firebaseio.com/",
            projectId: "tanacoin-mine",
            storageBucket: "tanacoin-mine.appspot.com",
            messagingSenderId: "550307127686",
            appId: "1:550307127686:web:a7fb30e74aefebf3280c07",
            measurementId: "G-596X16VEGX"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        const usernameEl = document.getElementById("username");
        const userBalanceDisplay = document.getElementById("userBalanceDisplay");
        const usdBalanceEl = document.getElementById("usdBalance");

        let currentUser;

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user.uid;
                const userRef = ref(db, `users/${currentUser}`);
                const snapshot = await get(userRef);

                if (snapshot.exists()) {
                    const data = snapshot.val();
                    usernameEl.textContent = data.username || "User";
                    userBalanceDisplay.textContent = data.userBalance || "0.0000";
                    usdBalanceEl.textContent = data.usdBalance || "0.00";
                }
            } else {
                alert("User not logged in!");
            }
        });

        const handleSell = async (market, amount, password) => {
            const userRef = ref(db, `users/${currentUser}`);
            const snapshot = await get(userRef);

            if (!snapshot.exists()) {
                alert("User data not found!");
                return;
            }

            const data = snapshot.val();
            if (data.password !== password) {
                alert("Invalid password!");
                return;
            }

            if (amount > data.userBalance) {
                alert("Insufficient TNC balance!");
                return;
            }

            const fee = market === "binance" ? 0.05905 : 0.062979;
            const usdAmount = amount * 5 * (1 - fee);

            await update(userRef, {
                userBalance: data.userBalance - amount,
                usdBalance: data.usdBalance + usdAmount,
            });

            alert(`Successfully sold ${amount} TNC for $${usdAmount.toFixed(2)}`);
        };

        document.getElementById("binanceBtn").addEventListener("click", () => {
            document.getElementById("binanceForm").style.display = "flex";
        });

        document.getElementById("coinbaseBtn").addEventListener("click", () => {
            document.getElementById("coinbaseForm").style.display = "flex";
        });

        document.getElementById("submitBinance").addEventListener("click", () => {
            const amount = parseFloat(document.getElementById("binanceAmount").value);
            const password = document.getElementById("binancePassword").value;
            handleSell("binance", amount, password);
        });

        document.getElementById("submitCoinbase").addEventListener("click", () => {
            const amount = parseFloat(document.getElementById("coinbaseAmount").value);
            const password = document.getElementById("coinbasePassword").value;
            handleSell("coinbase", amount, password);
        });

        document.getElementById("withdrawBtn").addEventListener("click", () => {
            document.getElementById("withdrawal-form").style.display = "flex";
        });

        document.getElementById("submitWithdrawal").addEventListener("click", async () => {
            const amount = parseFloat(document.getElementById("withdrawalAmount").value);
            const password = document.getElementById("withdrawalPassword").value;

            const userRef = ref(db, `users/${currentUser}`);
                    const snapshot = await get(ref(db, `users/${userId}`));
        if (snapshot.exists()) {
            const userData = snapshot.val();

            // Update the user interface with fetched data
try {
    if (userData) {
        usernameEl.innerHTML = `Welcome To Sell your <i style="color:red;">üïäÔ∏èTana</i><i style="color:green;">Coin</i> ${userData.username}`;
        userBalanceEl.textContent = userData.userBalance.toFixed(5);
        usdBalanceEl.textContent = userData.usdBalance.toFixed(2);
    } else {
        console.error('No user data found');
    }
} catch (error) {
    console.error('Error fetching user data:', error);
}


// Update user balance in Realtime Database
async function updateUserBalance(userId, newBalance) {
    try {
        await update(ref(db, `users/${userId}`), {
            userBalance: newBalance
        });
    } catch (error) {
        console.error('Error updating user balance:', error);
    }
}



// Handle Sell Button
function showSellForm(platform) {
    const platformFormId = platform.toLowerCase() + 'Form';
    const formHtml = `
        <div id="${platformFormId}" class="sell-form">
            <h3>Sell on ${platform}</h3>
            <input type="number" id="${platform.toLowerCase()}Amount" placeholder="TNC Amount" required>
            <input type="password" id="${platform.toLowerCase()}Password" placeholder="Password" required>
            <button id="submit${platform}Sell">Submit</button>
        </div>
    `;
    const marketSection = document.querySelector('.market-section');
    marketSection.innerHTML += formHtml;

    document
        .getElementById(`submit${platform}Sell`)
        .addEventListener('click', async () => {
            const tncAmount = parseFloat(
                document.getElementById(`${platform.toLowerCase()}Amount`).value
            );
            const password = document.getElementById(`${platform.toLowerCase()}Password`).value;

            if (isNaN(tncAmount) || tncAmount <= 0) {
                alert('Invalid TNC amount. Please enter a value greater than 0.');
                return;
            }

            if (!auth.currentUser) {
                alert('No user is currently logged in.');
                return;
            }

            try {
                const userId = auth.currentUser.uid;
                const snapshot = await get(ref(db, `users/${userId}`));
                if (!snapshot.exists()) {
                    alert('User data not found.');
                    return;
                }

                const userData = snapshot.val();
                if (userData.password !== password) {
                    alert('Incorrect password.');
                    return;
                }

                if (userData.userBalance < tncAmount) {
                    alert('Insufficient TanaCoin balance.');
                    return;
                }

                const marketPrice = parseFloat(document.getElementById('market-price').textContent);
                const platformFee = platform === 'Binance' ? 0.05905 : 0.062979;
                const sellValue = tncAmount * marketPrice * (1 - platformFee);

                // Update Firebase Balances
                await update(ref(db, `users/${userId}`), {
                    userBalance: userData.userBalance - tncAmount,
                    usdBalance: (userData.usdBalance || 0) + sellValue,
                });

                alert(`Successfully sold ${tncAmount} TNC for $${sellValue.toFixed(2)} on ${platform}.`);
                location.reload();
            } catch (error) {
                console.error('Error handling sell:', error);
                alert('An error occurred while processing your request.');
            }
        });
}

// Attach Event Listeners for Sell Buttons
document.getElementById('binanceBtn').addEventListener('click', () => {
    showSellForm('Binance');
});
document.getElementById('coinbaseBtn').addEventListener('click', () => {
    showSellForm('Coinbase');
});



// Gyaran withdrawal logic
document.getElementById("submitWithdrawal").addEventListener("click", async () => {
    const amount = parseFloat(document.getElementById("withdrawalAmount").value);
    const telegramWallet = document.getElementById("telegramWallet").value;
    const password = document.getElementById("withdrawalPassword").value;

    if (!amount || !telegramWallet || !password) {
        alert("Please fill all fields!");
        return;
    }

    try {
        const userRef = ref(db, `users/${currentUser}`);
        const snapshot = await get(userRef);

        if (!snapshot.exists()) {
            alert("User data not found!");
            return;
        }

        const data = snapshot.val();
        if (data.password !== password) {
            alert("Invalid password!");
            return;
        }

        if (amount > data.usdBalance) {
            alert("Insufficient USD balance!");
            return;
        }

        // Aika Withdrawal zuwa Telegram Bot
        const response = await fetch(`https://api.telegram.org/bot<TOKEN>/sendMessage`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                chat_id: "<CHAT_ID>",
                text: `New Withdrawal Request: \nAmount: $${amount}\nWallet: ${telegramWallet}`,
            }),
        });

        const result = await response.json();
        if (result.ok) {
            await update(userRef, {
                usdBalance: data.usdBalance - amount,
            });
            alert("Withdrawal successfully processed!");
        } else {
            alert("Withdrawal failed! Please try again later.");
        }
    } catch (error) {
        console.error("Error during withdrawal:", error);
        alert("An error occurred. Please try again later.");
    }
});

// Firebase Authentication State Listener
onAuthStateChanged(auth, (user) => {
    if (user) {
        getUserData(user.uid);
    } else {
        alert('User not authenticated.');
        }
        
    });    
    }
    });
    
    let totalCoins = 246.9;
const dailyCoins = 24.5902;
const startDate = new Date('2024-01-01');
const endTimeElement = document.getElementById('endTime');

function updateTanaCoinMining() {
    const now = new Date();
    const daysPassed = Math.floor((now - startDate) / (1000 * 60 * 60 * 24));
    const totalMined = totalCoins + (daysPassed * dailyCoins);
    
    // ∆òir∆ôiri lokacin ∆ôarshen mining
    const endTime = new Date(now.getTime() + (1000 * 60 * 60 * 24));
    endTimeElement.textContent = endTime.toLocaleString();
}

setInterval(updateTanaCoinMining, 1000);
updateTanaCoinMining();
</script>
</body>
</html>
